<!DOCTYPE html>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">

    

    <!-- 渲染优化 -->
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="HandheldFriendly" content="True" >
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!--icon-->

    
    
    
    
    


    <!-- meta -->


<title>linux-network | Harvey Li</title>





    <!-- OpenGraph -->


    
<link rel="stylesheet" href="/css/style/main.css">
 

    
    
        <link rel="stylesheet" id="hl-default-theme" href="/css/highlight/atom-one-light.css" media="none" >
        
            <link rel="stylesheet" id="hl-dark-theme" href="/css/highlight/atom-one-dark.css" media="none">
        
    

    
    

    
    
<link rel="stylesheet" href="/css/style/dark.css">

    
<script src="/js/darkmode.js"></script>



     

    <!-- custom head -->

<meta name="generator" content="Hexo 6.3.0"></head>

    <body>
        <div id="app" tabindex="-1">
            <header class="header">
    <div class="header__left">
        <a href="/" class="button">
            <span class="logo__text">Harvey Li</span>
        </a>
    </div>
    <div class="header__right">
        
            <div class="navbar__menus">
                
                    <a href="/" class="navbar-menu button">首页</a>
                
                    <a href="/tags/" class="navbar-menu button">标签</a>
                
                    <a href="/archives/" class="navbar-menu button">归档</a>
                
                    <a href="/about/" class="navbar-menu button">关于</a>
                
            </div>
        
        
        

        
        
    <a href="javaScript:void(0);" id="btn-toggle-dark">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
    </a>


        
            <a class="dropdown-icon button" id="btn-dropdown" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width='24' height='24' fill="none" stroke="currentColor" stroke-width="0.7" stroke-linecap="round" stroke-linejoin="round"><path fill="currentColor" d="M3.314,4.8h13.372c0.41,0,0.743-0.333,0.743-0.743c0-0.41-0.333-0.743-0.743-0.743H3.314c-0.41,0-0.743,0.333-0.743,0.743C2.571,4.467,2.904,4.8,3.314,4.8z M16.686,15.2H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,15.2,16.686,15.2z M16.686,9.257H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,9.257,16.686,9.257z"></path></svg></a>
            <div class="dropdown-menus" id="dropdown-menus">
                
                    <a href="/" class="dropdown-menu button">首页</a>
                
                    <a href="/tags/" class="dropdown-menu button">标签</a>
                
                    <a href="/archives/" class="dropdown-menu button">归档</a>
                
                    <a href="/about/" class="dropdown-menu button">关于</a>
                
            </div>
        
    </div>
</header>


            <main class="main">
    

<div class="post-title">
    <h1 class="post-title__text">
        linux-network
    </h1>
    <div class="post-title__meta">
        <a href="/archives/2024/03/" class="post-meta__date button">2024-03-28</a>
        
 
        
    
    


 

 
    </div>
</div>


    <aside class="post-side">
        <div class="post-side__toc">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE"><span class="toc-text">网络协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82"><span class="toc-text">应用层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DNS"><span class="toc-text">DNS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP"><span class="toc-text">HTTP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82"><span class="toc-text">传输层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E4%B8%8EUDP"><span class="toc-text">TCP与UDP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4"><span class="toc-text">常用网络命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ifconfig"><span class="toc-text">ifconfig</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E4%BF%A1%E6%81%AF"><span class="toc-text">查看网络地址信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%BC%80%E5%90%AF%E6%88%96%E5%85%B3%E9%97%AD%E7%BD%91%E5%8D%A1"><span class="toc-text">指定开启或关闭网卡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E3%80%81%E8%AE%BE%E7%BD%AEIP%E5%9C%B0%E5%9D%80"><span class="toc-text">修改、设置IP地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9MAC%E5%9C%B0%E5%9D%80"><span class="toc-text">修改MAC地址</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#route"><span class="toc-text">route</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%B7%AF%E7%94%B1%E8%A1%A8%E4%BF%A1%E6%81%AF"><span class="toc-text">查看路由表信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%A0%E9%99%A4%E7%BD%91%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-text">添加删除网关信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ip"><span class="toc-text">ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#netstat"><span class="toc-text">netstat</span></a></li></ol></li></ol>
        </div>
    </aside>
    <a class="btn-toc button" id="btn-toc" tabindex="0">
        <svg viewBox="0 0 1024 1024" width="32" height="32" xmlns="http://www.w3.org/2000/svg">
            <path d="M128 256h64V192H128zM320 256h576V192H320zM128 544h64v-64H128zM320 544h576v-64H320zM128 832h64v-64H128zM320 832h576v-64H320z" fill="currentColor"></path>
        </svg>
    </a>
    <div class="toc-menus" id="toc-menus">
        <div class="toc-title">文章目录</div>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE"><span class="toc-text">网络协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82"><span class="toc-text">应用层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DNS"><span class="toc-text">DNS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP"><span class="toc-text">HTTP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82"><span class="toc-text">传输层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP%E4%B8%8EUDP"><span class="toc-text">TCP与UDP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4"><span class="toc-text">常用网络命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ifconfig"><span class="toc-text">ifconfig</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E4%BF%A1%E6%81%AF"><span class="toc-text">查看网络地址信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%BC%80%E5%90%AF%E6%88%96%E5%85%B3%E9%97%AD%E7%BD%91%E5%8D%A1"><span class="toc-text">指定开启或关闭网卡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E3%80%81%E8%AE%BE%E7%BD%AEIP%E5%9C%B0%E5%9D%80"><span class="toc-text">修改、设置IP地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9MAC%E5%9C%B0%E5%9D%80"><span class="toc-text">修改MAC地址</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#route"><span class="toc-text">route</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%B7%AF%E7%94%B1%E8%A1%A8%E4%BF%A1%E6%81%AF"><span class="toc-text">查看路由表信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%A0%E9%99%A4%E7%BD%91%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-text">添加删除网关信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ip"><span class="toc-text">ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#netstat"><span class="toc-text">netstat</span></a></li></ol></li></ol>
    </div>


<article class="post post__with-toc content-card">
    <div class="post__header"></div>
    <div class="post__content">
        <h2 id="网络协议"><a href="#网络协议" class="headerlink" title="网络协议"></a>网络协议</h2><p>网络协议是计算机网络的核心概念。</p>
<p>在计算机网络中，为了使计算机之间能正确传输信息，必须有一条相关的规则、标准，它们被称为<strong>网络协议</strong>。</p>
<p>TCP&#x2F;IP网络协议标准，已经是Internet网络中的标准语言。</p>
<p><strong>1.开放系统互联参考模型（OSI&#x2F;RM）</strong></p>
<p>为了提供一个统一的技术标准，国际标准化组织推出了OSI&#x2F;RM体系结构，描述了一个较完整的网络体系结构，定义了系统的层次结构、每层提供的服务及层间接口。OSI&#x2F;RM体系结构共包括七层，从低到高分别是物理层、链路层、网络层、传输层、会话层、表示层、应用层。</p>
<p><strong>2.TCP&#x2F;IP协议</strong></p>
<p>互联网上的计算机之间进行通信最广泛实际使用的协议。</p>
<p>TCP&#x2F;IP代表TCP协议（传输控制协议）和IP协议（互联网协议），但它实际上是Internet通信协议集的总称，除了TCP协议和IP协议外，还包括了上百个具有独特功能的协议，如：地址解析协议（ARP）、互联网控制报文协议（ICMP）、超文本传输协议（HTTP）、文件传输协议（FTP）等。</p>
<p>TCP&#x2F;IP的四层结构：</p>
<ul>
<li><p>网络接口层：以二进制的数据形式在物理媒介上进行传输数据</p>
</li>
<li><p>互联网层：为数据包选择路由</p>
</li>
<li><p>传输层：提供端对端的接口 IP port</p>
</li>
<li><p>应用层：提供文件传输、邮件、文件共享、数据加密等等</p>
</li>
</ul>
<h3 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h3><p>应用层的任务主要是通过进程间的数据交互来完成特定的网络应用。</p>
<p>对于不同的网络应用需要使用不同的网络协议：域名解析系统用DNS协议，web服务用万维网HTTP协议，邮件传输用SMTP协议。</p>
<p>应用层交互的数据成为<strong>报文</strong>。</p>
<h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h4><p>域名解析系统（Domain Name System）是互联网的一个分布式数据库，主要存储IP和域名的对应关系，能够让普通用户更方便地使用互联网，而不必记住繁琐的IP地址号码。</p>
<h4 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h4><p>超文本传输协议（HyperText Transfer Protocol）是互联网上最为广泛应用的一种网络协议，所有的www万维网都要遵循这个标准，初衷是为了方便发布和接收HTML（前端的网页）文件。</p>
<h3 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h3><p>传输层的作用是向两台主机之间的进程之间进行数据传输。</p>
<p>传输协议主要有：</p>
<h4 id="TCP与UDP"><a href="#TCP与UDP" class="headerlink" title="TCP与UDP"></a>TCP与UDP</h4><p>TCP传输控制协议（Transmission Control Protocol），提供面向连接的、可靠的数据传输服务。</p>
<p>UDP用户数据协议（User Datagram Protocol），提供无连接的、尽最大努力的数据传输，但是不保证数据安全性。</p>
<p>两者的区别：</p>
<ul>
<li><p>UDP是无连接的，TCP是面向连接的（好比打电话，通话前需要先拨号连接上对方，且对方接电话了才能通信，最后需要对方挂掉电话才会断开连接）。</p>
</li>
<li><p>UDP只尽力传输，不保证数据可靠性，TCP的安全性很高，有两个传输的端点，是点对点、一对一的形式。</p>
</li>
<li><p>UDP是没有报文的，TCP有可靠的报文交互，传输的数据无差错、不重复、不丢失。</p>
</li>
<li><p>UDP支持一对一、一对多、多对一、多对多的交互通信。</p>
</li>
</ul>
<p>TCP适合文件传输和电子邮件等，UDP适合音频&#x2F;视频流媒体和在线游戏。</p>
<h2 id="常用网络命令"><a href="#常用网络命令" class="headerlink" title="常用网络命令"></a>常用网络命令</h2><h3 id="ifconfig"><a href="#ifconfig" class="headerlink" title="ifconfig"></a>ifconfig</h3><p>用于配置网卡IP地址信息等网络参数信息，或者查看网络接口信息，类似于Windows的<code>ipconfig</code>。还能临时性地配置IP地址、子网掩码、广播地址、网关信息等。</p>
<p>注意<code>ifconfig</code>命令只能用root操作，且可能要单独安装这个命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install net-tools</span><br></pre></td></tr></table></figure>

<h4 id="查看网络地址信息"><a href="#查看网络地址信息" class="headerlink" title="查看网络地址信息"></a>查看网络地址信息</h4><figure class="highlight shellsession"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line">ifconfig ens160</span><br><span class="line"></span><br><span class="line">[root@center ~]# ifconfig ens160</span><br><span class="line">ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.26.140  netmask 255.255.255.0  broadcast 192.168.26.255</span><br><span class="line">        inet6 fe80::20c:29ff:fe70:bd54  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:70:bd:54  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 22677  bytes 29076706 (27.7 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 12221  bytes 760043 (742.2 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">        device interrupt 48  memory 0x3fe00000-3fe20000 </span><br></pre></td></tr></table></figure>

<p>第一块网卡的信息，设备名是ens160，网卡配置文件路径是<code>/etc/sysconfig/network-scripts/ifcfg-ens160</code>，红帽9之后在<code>/etc/NetworkManager/system-connections/ens160.nmconnection</code>。<br>ipv4地址：inet 192.168.26.140<br>广播地址：broadcast 192.168.26.255<br>子网掩码地址：netmask 255.255.255.0<br>RX&#x2F;TX packets 代表网卡收发的流量数据包大小</p>
<h4 id="指定开启或关闭网卡"><a href="#指定开启或关闭网卡" class="headerlink" title="指定开启或关闭网卡"></a>指定开启或关闭网卡</h4><p>关闭网卡，注意不得在服务器上执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig &lt;device&gt; up/down</span><br></pre></td></tr></table></figure>

<h4 id="修改、设置IP地址"><a href="#修改、设置IP地址" class="headerlink" title="修改、设置IP地址"></a>修改、设置IP地址</h4><p>添加一个新IP地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifconfig ens160:0 192.168.26.188 netmask 255.255.255.0 up</span><br><span class="line">ifconfig ens160:0 192.168.26.188/24 up</span><br></pre></td></tr></table></figure>

<h4 id="修改MAC地址"><a href="#修改MAC地址" class="headerlink" title="修改MAC地址"></a>修改MAC地址</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig ens160 hw ether 00:0c:29:70:bd:54</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ifconfig命令只是临时修改网络配置，要永久修改还得写入配置文件。</p>
</blockquote>
<h3 id="route"><a href="#route" class="headerlink" title="route"></a>route</h3><p>路由：计算机之间的数据传输必须经过网络，网络可以直接连接两台计算机，也可以通过一个个节点去连接。路由可以理解为互联网的中转站，网络中的数据包就是通过一个个路由器转发到目的地的。</p>
<p><code>route</code>命令对Linux内核的路由表进行一个操作。</p>
<p>路由分为静态和动态路由。Linux机器上配置的都是静态路由，由运维人员通过route命令去管理；动态路由无需人为干预，由路由器、交换机自动分配规则而来。</p>
<h4 id="查看路由表信息"><a href="#查看路由表信息" class="headerlink" title="查看路由表信息"></a>查看路由表信息</h4><figure class="highlight shellsession"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@center ~]# route</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">default         _gateway        0.0.0.0         UG    100    0        0 ens160</span><br><span class="line">192.168.26.0    0.0.0.0         255.255.255.0   U     100    0        0 ens160</span><br><span class="line"></span><br><span class="line">[root@center ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.26.2    0.0.0.0         UG    100    0        0 ens160</span><br><span class="line">192.168.26.0    0.0.0.0         255.255.255.0   U     100    0        0 ens160</span><br></pre></td></tr></table></figure>

<p>参数解析：</p>
<p>Destination：网络号，network的意思<br>Gateway：网关地址，网络是通过该IP出口，如果显示0.0.0.0的ip，表示该路由信息是从本机转发出去的<br>Genmask：子网掩码地址的表示，IP地址配合子网掩码，才是一个完整的网络信息<br>Flags：路由标记，标记当前的网络状态</p>
<ul>
<li>U - Up运行的状态</li>
<li>G - 这是一个网关路由器</li>
<li>H - 这个网关是一个主机</li>
<li>！- 表示当前这个路由已经禁止</li>
</ul>
<h4 id="添加删除网关信息"><a href="#添加删除网关信息" class="headerlink" title="添加删除网关信息"></a>添加删除网关信息</h4><p>网关是连接两个不同网络的设备或软件，它能够实现数据在这两个网络之间的转发和转换。在互联网中，网关可以理解为连接内部局域网与外部互联网的出口，负责将内部主机的数据包转发到外部网络，并且将来自外部网络的数据包传递给内部主机。</p>
<p>网关是不经过任何的设定，由路由表最后经过的地址的关口。网络的关口，就好比家里的门一样，数据需要通过这个网关地址才能出外网。</p>
<p>删除default默认路由表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route del default</span><br></pre></td></tr></table></figure>

<p>添加一个网关地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route add default gw 192.268.26.2</span><br></pre></td></tr></table></figure>

<h3 id="ip"><a href="#ip" class="headerlink" title="ip"></a>ip</h3><p>ip命令是iproute软件包中强大的网络管理工具，具有ifconfig和route命令的作用，查看系统路由、网络设备，设置策略等功能。</p>
<figure class="highlight shellsession"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@center ~]# ip --help</span><br><span class="line">Usage: ip [ OPTIONS ] OBJECT &#123; COMMAND | help &#125;</span><br><span class="line">       ip [ -force ] -batch filename</span><br><span class="line">where  OBJECT := &#123; address | addrlabel | amt | fou | help | ila | ioam | l2tp |</span><br><span class="line">                   link | macsec | maddress | monitor | mptcp | mroute | mrule |</span><br><span class="line">                   neighbor | neighbour | netconf | netns | nexthop | ntable |</span><br><span class="line">                   ntbl | route | rule | sr | tap | tcpmetrics |</span><br><span class="line">                   token | tunnel | tuntap | vrf | xfrm &#125;</span><br><span class="line">       OPTIONS := &#123; -V[ersion] | -s[tatistics] | -d[etails] | -r[esolve] |</span><br><span class="line">                    -h[uman-readable] | -iec | -j[son] | -p[retty] |</span><br><span class="line">                    -f[amily] &#123; inet | inet6 | mpls | bridge | link &#125; |</span><br><span class="line">                    -4 | -6 | -M | -B | -0 |</span><br><span class="line">                    -l[oops] &#123; maximum-addr-flush-attempts &#125; | -br[ief] |</span><br><span class="line">                    -o[neline] | -t[imestamp] | -ts[hort] | -b[atch] [filename] |</span><br><span class="line">                    -rc[vbuf] [size] | -n[etns] name | -N[umeric] | -a[ll] |</span><br><span class="line">                    -c[olor]&#125;</span><br></pre></td></tr></table></figure>

<p>ip命令可以操作的对象</p>
<p>OBJECT对象</p>
<p>link 网络设备</p>
<p>address 定义 ipv4 ipv6 的地址</p>
<p>neighbour 查看ARP缓存地址（ARP用于解析MAC地址）</p>
<p>route 路由表对象</p>
<p>madress 多播地址</p>
<p>tunel IP上的通道</p>
<p>ip针对对象要操作的动作，一般增删改查。</p>
<p>查看网络设备信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ip addr show</span><br><span class="line">ip a  # 简写的 ip addr show</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定网络设备</span></span><br><span class="line">ip link show dev ens160</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示网络设备详细的数据包统计信息</span></span><br><span class="line">ip -s link show dev ens160</span><br></pre></td></tr></table></figure>

<p>关闭、激活网络设备</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip link set ens160 down/up  # 关闭/启动网卡</span><br></pre></td></tr></table></figure>

<p>更改MAC</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip link set ens160 address 00:0c:29:70:bd:54</span><br></pre></td></tr></table></figure>

<p>添加、删除ip信息</p>
<p>一台主机在需要承担多个网络角色或者服务时，可能需要多个IP地址。比如，如果主机同时作为Web服务器、邮件服务器和数据库服务器，那么每个服务可能都需要独立的IP地址来进行通信。此外，在虚拟化环境中，一台物理主机上运行的多个虚拟机也可能会分配到不同的IP地址。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip address add 192.168.26.150/24 dev ens160</span><br><span class="line">ip address del 192.168.26.150/24 dev ens160</span><br></pre></td></tr></table></figure>

<p>给网卡添加别名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip address add 192.168.26.150/24 dev ens160 label ens160:1</span><br></pre></td></tr></table></figure>

<p>查看路由表</p>
<figure class="highlight shellsession"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@center ~]# ip route</span><br><span class="line">default via 192.168.26.2 dev ens160 proto static metric 100 </span><br><span class="line">192.168.26.0/24 dev ens160 proto kernel scope link src 192.168.26.140 metric 100 </span><br><span class="line">192.168.26.0/24 dev ens160 proto kernel scope link src 192.168.26.128 metric 100 </span><br></pre></td></tr></table></figure>

<p>检查ARP缓存（显示网络邻居的信息），检查MAC地址信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip neighbour</span><br><span class="line">arp -n  # 二者差不多</span><br></pre></td></tr></table></figure>

<h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><p>显示网络连接情况，路由表信息，端口状态等信息。</p>
<p>一个进程服务运行之后，会暴露一个端口号，以及产生响应的进程信息。</p>
<p>查看所有的网络连接情况</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netstat -an</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-a 显示所有的套接字信息</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-n 显示数字地址信息而非主机名</span></span><br></pre></td></tr></table></figure>

<p>常见字段解释</p>
<p>proto 套接字（一个连接情况）使用的协议<br>Recv-Q 连接这个套接字的用户还未拷贝的字节数<br>Send-Q 远程主机还未确认的字节数<br>Local address 套接字本地的地址和端口号<br>Foreign address 套接字的远程主机地址和端口号<br>State 套接字的运行情况 LISTEN监听中</p>
<p>记住一些重要的套接字连接情况的参数<br>ESTABLISHED<br>套接字有一个有效连接。<br>SYN_SENT<br>套接字尝试建立一个连接。<br>SYN RECV<br>从网络上收到一个连接请求。<br>FIN_ WAIT1<br>套接字已关闭，连接正在断开。<br>FIN_WAIT2<br>连接已关闭，套接字等待远程方中止。<br>TIME_WAIT<br>在关闭之后，套接字等待处理仍然在网络中的分组<br>CLOSED<br>套接字未用。<br>CLOSE_ WAIT<br>远程方已关闭，等待套接字关闭。<br>LAST_ACK<br>远程方中止，套接字已关闭。等待确认。<br>LISTEN<br>套接字监听进来的连接。如果不设置–listening（-L）或者—-all（-a）选项，将不显示出来这些连接。<br>CLOSING<br>套接字都已关闭，而还未把所有数据发出。<br>UNKNOWN<br>套接字状态未知。</p>
<p>常用的参数组合</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">netstat -tunlp  # 查看机器上正在运行的所有端口及其进程情况</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-t 显示出TCP的连接情况</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-u 显示出UDP的连接情况</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-n 不进行dns解析</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-l 只显示正在监听中的套接字情况</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 显示出套接字所属的进程和进程名情况</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">127.0.0.1  本地回环地址，用于机器间内部应用通信</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">0.0.0.0  绑定机器所有的网卡地址</span></span><br></pre></td></tr></table></figure>

<p>检查服务器端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netstat -tunlp | grep 3306  # MySQL</span><br><span class="line">netstat -tunlp | grep 80  # web服务</span><br><span class="line">netstat -tunlp | grep 443  # https服务</span><br></pre></td></tr></table></figure>

<p>检查路由表情况</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -rn  # 等同于 route -n</span><br></pre></td></tr></table></figure>

<p>显示网络接口情况</p>
<figure class="highlight shellsession"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@center ~]# netstat -i  # 显示出所有网络接口的列表情况</span><br><span class="line">Kernel Interface table</span><br><span class="line">Iface             MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg</span><br><span class="line">docker0          1500        0      0      0 0             0      0      0      0 BMU</span><br><span class="line">ens160           1500    83567      0      0 0         23242      0      0      0 BMRU</span><br><span class="line">lo              65536       31      0      0 0            31      0      0      0 LRU</span><br></pre></td></tr></table></figure>

<p>字段解释：<br>Iface<br>网络设备的名字<br>MTU<br>最大的传输单元，单位是字节<br>RX-OK&#x2F;TX-OK<br>正确接收了多少数据包，发送了多少数据包<br>RX-ERR&#x2F;TX-ERR<br>接收、发送数据包的时候，丢弃了多少数据包<br>RX-OVR&#x2F;TX-OVR 由于错误遗失了多少的数据包<br>Flg标记<br>L：回环地址<br>R：这个网络接口正在运行中<br>U：接口正在处于活动的状态<br>B：设置了广播地址<br>M：接收所有的数据包<br>O：在该接口上禁止arp<br>P：端对端的连接</p>
<p>CentOS 7 之后出现的网络查看工具 ss</p>
<p>如果没有要安装<code>yum install iproute</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ss -an  # 显示所有的套接字连接情况</span><br><span class="line">ss -tunlp  # 显示出所有正在监听中的套接字情况</span><br></pre></td></tr></table></figure>

    </div>
    
    <div class="post__license">
        <p>
            <strong>本文作者：</strong>liyijie
        </p>
        <p>
            <strong>本文链接：</strong><a href="https://liyijie.cn/2024/linux-network/">https://liyijie.cn/2024/linux-network/</a>
        </p>
        
            <strong>
                <p>文章默认以 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享</a> 授权。</p>

            </strong>
        
    </div>

 
    <div class="post-footer__meta"><p>更新于 2024-03-28</p></div> 
    <div class="post-entry__tags"></div> 
</article>


    <div class="nav">
        <div class="nav__prev">
            
        </div>
        <div class="nav__next">
            
                <a href="/2024/ops-automation-2/" class="nav__link">
                    <div>
                        <div class="nav__label">
                            下一篇
                        </div>
                        <div class="nav__title">
                            自动化运维（二）：Python
                        </div>
                    </div>
                    <div>
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M434.944 790.624l-45.248-45.248L623.04 512l-233.376-233.376 45.248-45.248L713.568 512z" fill="#808080"></path></svg>
                    </div>
                </a>
            
        </div>
    </div>





</main>

            <footer class="footer">
    
    


    
     
 

 
    
        
        <p class="footer-copyright">
            Copyright © 2024 <a href="/">Harvey Li</a>
        </p>
    
    
    <p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme - <a href="https://github.com/ChrAlpha/hexo-theme-cards" target="_blank">Cards</a></p>
</footer>

        </div>
         

 

 

 

 



 



 


    
 

 

 

 

 

 




    </body>
</html>
